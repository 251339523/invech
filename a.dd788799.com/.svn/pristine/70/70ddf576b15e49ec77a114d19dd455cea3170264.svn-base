<?php 
namespace app\api\controller;

use app\api\Base;
use think\Cache;
use think\Response;
use bong\service\auth\traits\ThrottlesLogins;
use app\api\error\CodeBase;
use bong\service\CaptchaService;

class Pub extends Base {
    
    use ThrottlesLogins;

    //app注册只需要用户名和密码即可;
    public function register(){

    }    

    public function login(){
        
        try{
            if($ret = $this->doLogin($this->request,true)){
                $user = request()->user();
                event('user.login',[$user]);                          
                return $this->apiReturn([],$ret);
            }
            return $this->apiReturn(CodeBase::$error,'用户名或密码错误!');
        }catch(\Exception $e){
            return $this->apiReturn(CodeBase::$error,$e->getMessage());
        }

        
    }

    public function index(){
        /*
        $data = ['status'=>1,'msg'=>'HttpResponseException!',];
        $response = Response::create($data, 'json');
        abort($response);
        */
        return $this->apiReturn([],'index');
    }

    public function captcha($config='default')
    {
        $ret = (new CaptchaService())->captcha($config);
        return $this->apiReturn([],$ret);
    }     

    public function check_verify($config='default')
    {
        $ret = (new CaptchaService())->check_verify('1234','$2y$10$gILB2GlXXpN.KVXiEVAp6OQJdMK7Ft3rGSajj.teiFsxWgd3GkHyy');
        return $this->apiReturn([],$ret);
    }   
    
    public function app(){
        $name = input('name');
        if(empty($name)){
            $name = 'default';
        }
        $status = config('app_shenhe');
        $data = $status[$name]??[];
        return $this->apiReturn([],$data);
    }

}

